# Docker Compose override for frontend development
# Extends the main docker-compose.yml with frontend service

services:
  # Frontend Production Server
  frontend:
    build:
      context: .
      dockerfile: ./Dockerfile.frontend
    container_name: fin-frontend-prod
    environment:
      - NODE_ENV=production
      - CONTAINER_MODE=true
      # API communication through host (browser can't resolve container service names)
      - VITE_API_URL=http://localhost:8080/api
      - VITE_API_URL=http://fin-app:8080/api
    ports:
      - "3000:3000"
    depends_on:
      fin-app:
        condition: service_healthy
    networks:
      - fin-network
    restart: unless-stopped

  # Override backend CORS for container networking
  fin-app:
    environment:
      # CORS for both external access and container communication
      - CORS_ALLOWED_ORIGINS=http://localhost:3000,https://localhost:3000,http://127.0.0.1:3000,https://127.0.0.1:3000,http://fin-frontend-prod:3000,https://fin-frontend-prod:3000
      - SPRING_SECURITY_CORS_ALLOWED_ORIGINS=http://localhost:3000,https://localhost:3000,http://127.0.0.1:3000,https://127.0.0.1:3000,http://fin-frontend-prod:3000,https://fin-frontend-prod:3000
      - SPRING_SECURITY_CORS_ALLOWED_HEADERS=*
      - SPRING_SECURITY_CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
      - SPRING_SECURITY_CORS_ALLOW_CREDENTIALS=true
      - SPRING_PROFILES_ACTIVE=docker,dev